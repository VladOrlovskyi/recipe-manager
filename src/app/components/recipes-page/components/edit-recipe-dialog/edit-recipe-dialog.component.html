<h2 mat-dialog-title>Edit Recipe: {{ data.name }}</h2>

<mat-dialog-content class="mat-typography">
  <form [formGroup]="editForm" class="grid grid-cols-2 gap-4 mt-4">
    <div class="card">
      <p>Basic Information</p>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" required />
        <mat-error
          *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched"
        >
          Enter name
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Image URL</mat-label>
        <input matInput formControlName="image" required />
        <mat-error
          *ngIf="
            editForm.get('image')?.invalid && editForm.get('image')?.touched
          "
        >
          Enter image URL
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Cuisine</mat-label>
        <input matInput formControlName="cuisine" required />
        <mat-error
          *ngIf="
            editForm.get('cuisine')?.invalid && editForm.get('cuisine')?.touched
          "
        >
          Enter Cuisine
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Difficulty</mat-label>
        <mat-select formControlName="difficulty" required>
          <mat-option value="Easy">Easy</mat-option>
          <mat-option value="Medium">Medium</mat-option>
          <mat-option value="Hard">Hard</mat-option>
        </mat-select>
        <mat-error
          *ngIf="
            editForm.get('difficulty')?.invalid &&
            editForm.get('difficulty')?.touched
          "
        >
          Enter difficulty
        </mat-error>
      </mat-form-field>
    </div>
    <div class="card">
      <p>Recipe Details</p>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Prep Time (min)</mat-label>
        <input
          matInput
          type="number"
          formControlName="prepTimeMinutes"
          required
        />
        <mat-error
          *ngIf="
            editForm.get('prepTimeMinutes')?.invalid &&
            editForm.get('prepTimeMinutes')?.touched
          "
        >
          Enter Prep Time
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Cook Time (min)</mat-label>
        <input
          matInput
          type="number"
          formControlName="cookTimeMinutes"
          required
        />
        <mat-error
          *ngIf="
            editForm.get('cookTimeMinutes')?.invalid &&
            editForm.get('cookTimeMinutes')?.touched
          "
        >
          Enter Cook Time
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Servings</mat-label>
        <input matInput type="number" formControlName="servings" required />
        <mat-error
          *ngIf="
            editForm.get('servings')?.invalid &&
            editForm.get('servings')?.touched
          "
        >
          Enter Servings
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Calories</mat-label>
        <input
          matInput
          type="number"
          formControlName="caloriesPerServing"
          required
        />
        <mat-error
          *ngIf="
            editForm.get('caloriesPerServing')?.invalid &&
            editForm.get('caloriesPerServing')?.touched
          "
        >
          Enter calories
        </mat-error>
      </mat-form-field>
    </div>
    <div class="card">
      <p>Additional Details (Optional)</p>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>User ID</mat-label>
        <input matInput type="number" formControlName="userId" required />
        <mat-error
          *ngIf="
            editForm.get('userId')?.invalid && editForm.get('userId')?.touched
          "
        >
          Enter User ID
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Rating (0-5)</mat-label>
        <input matInput type="number" formControlName="rating" required />
        <mat-error
          *ngIf="
            editForm.get('rating')?.invalid && editForm.get('rating')?.touched
          "
        >
          Enter rating
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="col-span-2 sm:col-span-1">
        <mat-label>Review Count</mat-label>
        <input matInput type="number" formControlName="reviewCount" required />
        <mat-error
          *ngIf="
            editForm.get('reviewCount')?.invalid &&
            editForm.get('reviewCount')?.touched
          "
        >
          Enter Review Count
        </mat-error>
      </mat-form-field>
    </div>
    <div class="card">
      <p>Tags</p>
      <mat-form-field appearance="outline" class="flex-grow">
        <mat-label>Add tag</mat-label>
        <input
          matInput
          [formControl]="newTagControl"
          (keydown.enter)="addTag()"
          placeholder="Add a tag (e.g., Vegetarian, Quick)"
        />
      </mat-form-field>
      <button
        mat-flat-button
        color="primary"
        (click)="addTag()"
        [disabled]="newTagControl.value.trim() === ''"
      >
        Add
      </button>
      <div formArrayName="tags" class="flex flex-wrap gap-2">
        <div
          *ngFor="let tagControl of tagsArray.controls; let i = index"
          class="flex items-center bg-gray-200 text-gray-700 rounded-full px-3 py-1 text-sm font-medium custom-tag"
        >
          {{ tagControl.value }}
          <button (click)="removeTag(i)" class="w-4 h-4 ml-1 -mr-1 x-btn">
            x
          </button>
        </div>
        <div *ngIf="tagsArray.length === 0" class="text-sm text-gray-500">
          Empty
        </div>
      </div>
    </div>
    <div class="card">
      <p>Meal Type</p>

      <mat-form-field appearance="outline" class="flex-grow">
        <mat-label>Add type</mat-label>
        <input
          matInput
          [formControl]="newMealTypeControl"
          (keydown.enter)="addMealType()"
          placeholder="Add a meal type (e.g., Lunch, Dinner)"
        />
      </mat-form-field>
      <button
        mat-flat-button
        color="primary"
        (click)="addMealType()"
        [disabled]="newMealTypeControl.value.trim() === ''"
      >
        Add
      </button>
      <div formArrayName="mealType" class="flex flex-wrap gap-2">
        <div
          *ngFor="let typeControl of mealTypeArray.controls; let i = index"
          class="flex items-center bg-gray-200 text-gray-700 rounded-full px-3 py-1 text-sm font-medium custom-tag"
        >
          {{ typeControl.value }}
          <button (click)="removeMealType(i)" class="w-4 h-4 ml-1 -mr-1 x-btn">
            x
          </button>
        </div>
        <div *ngIf="mealTypeArray.length === 0" class="text-sm text-gray-500">
          Empty
        </div>
      </div>
    </div>
    <div class="card">
      <p>Ingredients</p>
      <div [formArrayName]="'ingredients'" class="space-y-3">
        <div
          *ngFor="
            let ingredientControl of ingredientsArray.controls;
            let i = index
          "
          class="flex items-center space-x-2 custom-box"
        >
          <mat-form-field appearance="fill" class="flex-grow custom-input">
            <mat-label>Ingridient</mat-label>
            <input matInput [formControlName]="i" required />
          </mat-form-field>
          <button
            color="warn"
            class="x-btn"
            (click)="removeIngredient(i)"
            [disabled]="ingredientsArray.length === 1"
          >
            x
          </button>
        </div>
      </div>
      <button
        mat-flat-button
        color="accent"
        (click)="addIngredient()"
        class="w-full mt-4"
      >
        Add
      </button>
    </div>
    <div class="card">
      <p>Instructions</p>
      <div [formArrayName]="'instructions'" class="space-y-3">
        <!-- Ітерація по FormArray, створюючи блок для кожного кроку -->
        <div
          *ngFor="
            let instructionControl of instructionsArray.controls;
            let i = index
          "
          class="flex items-start space-x-2 instruction-step custom-box"
        >
          <div class="text-lg font-semibold w-6 pt-3 text-right">
            {{ i + 1 }}.
          </div>
          <mat-form-field
            appearance="fill"
            class="flex-grow custom-input-field custom-input"
          >
            <textarea
              matInput
              [formControlName]="i"
              required
              rows="2"
            ></textarea>
          </mat-form-field>
          <button
            (click)="removeInstruction(i)"
            color="warn"
            [disabled]="instructionsArray.length === 1"
            class="delete-button mt-2 x-btn"
          >
            x
          </button>
        </div>
      </div>
      <div class="flex items-center space-x-2 mt-4 custom-box">
        <mat-form-field appearance="outline" class="flex-grow custom-input">
          <mat-label>Add</mat-label>
          <input
            matInput
            [formControl]="newInstructionControl"
            (keydown.enter)="addInstruction()"
          />
        </mat-form-field>

        <button
          mat-flat-button
          color="accent"
          style="height:100%"
          (click)="addInstruction()"
          [disabled]="newInstructionControl.value.trim() === ''"
        >
          Add
        </button>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Cancel</button>
  <button
    mat-raised-button
    color="primary"
    [disabled]="editForm.invalid"
    (click)="saveChanges()"
    cdkFocusInitial
  >
    Edit
  </button>
</mat-dialog-actions>
